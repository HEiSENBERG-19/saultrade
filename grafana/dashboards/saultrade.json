{
  "id": null,
  "uid": "saultrade-dashboard-v2",
  "title": "SaulTrade Live Performance",
  "tags": ["trading", "influxdb", "pnl", "positions"],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 2,
  "refresh": "5s",
  "templating": {
    "list": [
      {
        "current": {},
        "datasource": {
          "type": "influxdb",
          "uid": "InfluxDB" 
        },
        "definition": "import \"influxdata/influxdb/schema\"\nschema.tagValues(bucket: \"mybucket\", tag: \"symbol\")",
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "symbol",
        "options": [],
        "query": "import \"influxdata/influxdb/schema\"\nschema.tagValues(bucket: \"mybucket\", tag: \"symbol\")",
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 1,
        "type": "query"
      }
    ]
  },
  "panels": [
    {
      "type": "row",
      "title": "Key Performance Indicators",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }
    },
    {
      "type": "stat",
      "title": "Total PnL",
      "datasource": "InfluxDB",
      "gridPos": { "h": 4, "w": 5, "x": 0, "y": 1 },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "orientation": "auto", "colorMode": "value", "graphMode": "area" },
      "pluginVersion": "10.1.1",
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pnl\" and r._field == \"total_pnl\")\n  |> last()"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Return on Investment (ROI)",
      "datasource": "InfluxDB",
      "gridPos": { "h": 4, "w": 4, "x": 5, "y": 1 },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value", "graphMode": "area" },
      "fieldConfig": { "defaults": { "unit": "percent" } },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pnl\" and r._field == \"roi\")\n  |> last()"
        }
      ]
    },
    {
        "type": "stat",
        "title": "Active Symbols",
        "datasource": "InfluxDB",
        "gridPos": { "h": 4, "w": 5, "x": 9, "y": 1 },
        "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "orientation": "auto", "colorMode": "value", "graphMode": "none" },
        "targets": [
          {
            "refId": "A",
            "query": "from(bucket: \"mybucket\")\n  |> range(start: -1h)\n  |> filter(fn: (r) => r._measurement == \"positions\")\n  |> keep(columns: [\"symbol\"])\n  |> distinct(column: \"symbol\")\n  |> count()"
          }
        ]
      },
    {
      "type": "stat",
      "title": "Total Entry Value",
      "datasource": "InfluxDB",
      "gridPos": { "h": 4, "w": 5, "x": 14, "y": 1 },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "graphMode": "area" },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pnl\" and r._field == \"total_entry_value\")\n  |> last()"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Total Current Value",
      "datasource": "InfluxDB",
      "gridPos": { "h": 4, "w": 5, "x": 19, "y": 1 },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "graphMode": "area" },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pnl\" and r._field == \"total_current_value\")\n  |> last()"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Total PnL Over Time",
      "datasource": "InfluxDB",
      "gridPos": { "h": 7, "w": 24, "x": 0, "y": 5 },
      "fieldConfig": { "defaults": { "color": { "mode": "palette-classic" }, "custom": {"fillOpacity": 20, "lineWidth": 2} } },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pnl\" and r._field == \"total_pnl\")"
        }
      ]
    },
    {
      "type": "row",
      "title": "Live Positions",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 12 }
    },
    {
      "type": "table",
      "title": "Active Positions Summary",
      "datasource": "InfluxDB",
      "gridPos": { "h": 8, "w": 14, "x": 0, "y": 13 },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"positions\")\n  |> filter(fn: (r) => r[\"_field\"] == \"price\" or r[\"_field\"] == \"quantity\" or r[\"_field\"] == \"pnl\")\n  |> last()\n  |> pivot(rowKey:[\"_time\", \"symbol\"], columnKey: [\"_field\"], valueColumn: \"_value\")\n  |> keep(columns: [\"symbol\", \"price\", \"quantity\", \"pnl\"])"
        }
      ],
      "fieldConfig": {
        "defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 0}]}},
        "overrides": [
            {"matcher": {"id": "byName", "options": "pnl"}, "properties": [{"id": "unit", "value": "short"}]},
            {"matcher": {"id": "byName", "options": "price"}, "properties": [{"id": "unit", "value": "short"}]},
            {"matcher": {"id": "byName", "options": "quantity"}, "properties": [{"id": "unit", "value": "short"}]}
        ]
      }
    },
    {
        "type": "barchart",
        "title": "Final PnL by Symbol",
        "datasource": "InfluxDB",
        "gridPos": { "h": 8, "w": 10, "x": 14, "y": 13 },
        "targets": [
          {
            "refId": "A",
            "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"positions\" and r._field == \"pnl\")\n  |> last()\n  |> group(columns: [\"symbol\"])"
          }
        ],
        "options": {"orientation": "horizontal", "colorByField": "pnl"}
    },
    {
      "type": "row",
      "title": "Symbol Deep Dive",
      "collapsed": true,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 21 }
    },
    {
      "type": "timeseries",
      "title": "${symbol} - Price",
      "datasource": "InfluxDB",
      "gridPos": { "h": 7, "w": 8, "x": 0, "y": 22 },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"positions\" and r._field == \"price\" and r.symbol == \"${symbol}\")"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "${symbol} - Quantity",
      "datasource": "InfluxDB",
      "gridPos": { "h": 7, "w": 8, "x": 8, "y": 22 },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"positions\" and r._field == \"quantity\" and r.symbol == \"${symbol}\")"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "${symbol} - PnL",
      "datasource": "InfluxDB",
      "gridPos": { "h": 7, "w": 8, "x": 16, "y": 22 },
      "targets": [
        {
          "refId": "A",
          "query": "from(bucket: \"mybucket\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"positions\" and r._field == \"pnl\" and r.symbol == \"${symbol}\")"
        }
      ]
    }
  ]
}